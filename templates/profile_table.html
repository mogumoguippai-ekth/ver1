{% extends "base.html" %}

{% block title %}私について一覧 - 私の望む暮らし{% endblock %}

{% block page_title %}私について一覧{% endblock %}

{% block nickname %}{{ session.get('nickname', 'ゲスト') }}{% endblock %}

{% block content %}
<div class="profile-table-page">
    <h2>私について一覧</h2>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="alert alert-success">
        {{ messages[0] }}
    </div>
    {% endif %}
    {% endwith %}

    <div class="table-container">
        <div class="table-header">
            <div class="table-info">
                {% if user %}
                <p><strong>ユーザーID:</strong> {{ user[1] }}</p>
                <p><strong>作成日:</strong> {{ user[13] if user[13] else '未設定' }}</p>
                <p><strong>更新日:</strong> {{ user[14] if user[14] else '未設定' }}</p>
                {% endif %}
            </div>
            <div class="print-export">
                <button onclick="printProfile()" class="print-btn">印刷</button>
            </div>
        </div>

        <table class="profile-table" id="profileTable">
            <thead>
                <tr>
                    <th colspan="2">私の基本情報</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="label-cell">ユーザーID</td>
                    <td class="data-cell">{{ user[1] if user else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">メールアドレス</td>
                    <td class="data-cell">{{ user[2] if user else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">氏名</td>
                    <td class="data-cell">{{ user[5] if user and user[5] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">フリガナ</td>
                    <td class="data-cell">{{ user[6] if user and user[6] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">ニックネーム</td>
                    <td class="data-cell">{{ user[7] if user and user[7] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">性別</td>
                    <td class="data-cell">{{ user[8] if user and user[8] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">生年月日</td>
                    <td class="data-cell">{{ user[9] if user and user[9] else '未設定' }}</td>
                </tr>
            </tbody>
        </table>

        <table class="profile-table" id="profileDetailTable">
            <thead>
                <tr>
                    <th colspan="2">私の詳細情報</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="label-cell">作成日</td>
                    <td class="data-cell">{{ profile[13] if profile and profile[13] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">更新日</td>
                    <td class="data-cell">{{ profile[14] if profile and profile[14] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">住まい</td>
                    <td class="data-cell">{{ profile[2] if profile and profile[2] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">配偶者について</td>
                    <td class="data-cell">{{ profile[3] if profile and profile[3] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">同居している子どもの性別と人数</td>
                    <td class="data-cell">{{ profile[4] if profile and profile[4] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">別居している子どもの性別と人数</td>
                    <td class="data-cell">{{ profile[5] if profile and profile[5] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">治療の終わった病気</td>
                    <td class="data-cell">{{ profile[6] if profile and profile[6] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">治療している病気</td>
                    <td class="data-cell">{{ profile[7] if profile and profile[7] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">かかっている医療機関</td>
                    <td class="data-cell">{{ profile[8] if profile and profile[8] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">一番頼りにしている家族</td>
                    <td class="data-cell">{{ profile[9] if profile and profile[9] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">頼りにしている隣人</td>
                    <td class="data-cell">{{ profile[10] if profile and profile[10] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">よく相談している友人</td>
                    <td class="data-cell">{{ profile[11] if profile and profile[11] else '未設定' }}</td>
                </tr>
                <tr>
                    <td class="label-cell">私の暮らしを支えるお金</td>
                    <td class="data-cell">{{ profile[12] if profile and profile[12] else '未設定' }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="action-buttons">
        <div class="button-group">
            <a href="{{ url_for('profile') }}" class="edit-btn">訂正</a>
            <a href="{{ url_for('profile') }}" class="create-btn">新規作成</a>
            <form method="POST" action="{{ url_for('delete_profile') }}" style="display: inline;" onsubmit="return confirm('私の詳細情報を削除しますか？この操作は取り消せません。')">
                <button type="submit" class="delete-btn">削除</button>
            </form>
        </div>
        <div class="navigation-buttons">
            <a href="{{ url_for('dashboard') }}" class="back-btn">HOMEに戻る</a>
        </div>
    </div>
</div>

<script>
    function printProfile() {
        // 印刷用のスタイルを適用
        const printStyles = `
            <style>
                @media print {
                    .action-buttons, .print-export {
                        display: none;
                    }
                    .profile-table-page {
                        max-width: none;
                        margin: 0;
                        padding: 20px;
                    }
                    .table-container {
                        box-shadow: none;
                        border: 1px solid #ddd;
                    }
                    .profile-table {
                        font-size: 12pt;
                        line-height: 1.4;
                        border-collapse: collapse;
                        border: 1px solid #333;
                        width: 100%;
                        table-layout: fixed;
                    }
                    .profile-table th {
                        border: 1px solid #333;
                        background: #f5f5f5;
                        padding: 8px;
                        font-weight: bold;
                        width: 30%;
                        vertical-align: top;
                    }
                    .profile-table td {
                        padding: 8px;
                        border: 1px solid #333;
                        width: 70%;
                        vertical-align: top;
                        word-wrap: break-word;
                    }
                    body {
                        font-size: 12pt;
                        line-height: 1.4;
                    }
                    .table-info {
                        margin-bottom: 20px;
                        padding: 10px;
                        background: #f8f9fa;
                        border-radius: 5px;
                    }
                }
            </style>
        `;

        // 印刷用ウィンドウを開く
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
                <head>
                    <title>私について一覧</title>
                    ${printStyles}
                </head>
                <body>
                    <h1>私について一覧</h1>
                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-info">
                                {% if user %}
                                <p><strong>ユーザーID:</strong> {{ user[1] }}</p>
                                <p><strong>作成日:</strong> {{ user[13] if user[13] else '未設定' }}</p>
                                <p><strong>更新日:</strong> {{ user[14] if user[14] else '未設定' }}</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <table class="profile-table">
                            <thead>
                                <tr>
                                    <th colspan="2">私の基本情報</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="label-cell">ユーザーID</td>
                                    <td class="data-cell">{{ user[1] if user else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">メールアドレス</td>
                                    <td class="data-cell">{{ user[2] if user else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">氏名</td>
                                    <td class="data-cell">{{ user[5] if user and user[5] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">フリガナ</td>
                                    <td class="data-cell">{{ user[6] if user and user[6] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">ニックネーム</td>
                                    <td class="data-cell">{{ user[7] if user and user[7] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">性別</td>
                                    <td class="data-cell">{{ user[8] if user and user[8] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">生年月日</td>
                                    <td class="data-cell">{{ user[9] if user and user[9] else '未設定' }}</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <table class="profile-table">
                            <thead>
                                <tr>
                                    <th colspan="2">私の詳細情報</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="label-cell">作成日</td>
                                    <td class="data-cell">{{ profile[13] if profile and profile[13] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">更新日</td>
                                    <td class="data-cell">{{ profile[14] if profile and profile[14] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">住まい</td>
                                    <td class="data-cell">{{ profile[2] if profile and profile[2] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">配偶者について</td>
                                    <td class="data-cell">{{ profile[3] if profile and profile[3] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">同居している子どもの性別と人数</td>
                                    <td class="data-cell">{{ profile[4] if profile and profile[4] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">別居している子どもの性別と人数</td>
                                    <td class="data-cell">{{ profile[5] if profile and profile[5] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">治療の終わった病気</td>
                                    <td class="data-cell">{{ profile[6] if profile and profile[6] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">治療している病気</td>
                                    <td class="data-cell">{{ profile[7] if profile and profile[7] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">かかっている医療機関</td>
                                    <td class="data-cell">{{ profile[8] if profile and profile[8] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">一番頼りにしている家族</td>
                                    <td class="data-cell">{{ profile[9] if profile and profile[9] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">頼りにしている隣人</td>
                                    <td class="data-cell">{{ profile[10] if profile and profile[10] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">よく相談している友人</td>
                                    <td class="data-cell">{{ profile[11] if profile and profile[11] else '未設定' }}</td>
                                </tr>
                                <tr>
                                    <td class="label-cell">私の暮らしを支えるお金</td>
                                    <td class="data-cell">{{ profile[12] if profile and profile[12] else '未設定' }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.print();
    }
</script>
{% endblock %}
